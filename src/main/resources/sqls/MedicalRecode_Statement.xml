<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pet.care.model.dao.hospital.IMedicalRecodeDao">

<!-- 진료내역 추가 -->
	<insert id="insertRecode">
		INSERT INTO MEDICALRECODE
   				(SEQ, PET_ID, SYMPTOM,
   				TREATMENT, PRESCRIPTION, TREATDATE,
    			HOSPITAL_SEQ)
		VALUES(MEDICALRECODE_SEQ.NEXTVAL, 'kckt66002M01', '설사',
       			'과식', '설사약', SYSDATE,
          		 '1')
	</insert>
	
<!-- 병원 진료내역 리스트 조회 -->
	<select id="recodeList">
		SELECT SEQ , PETNAME , SYMPTOM ,
      				NAME , TREATDATE , HOSPITAL_SEQ 
    		FROM(
					SELECT m.SEQ , p.NAME PETNAME, m.SYMPTOM ,
     						u.NAME , m.TREATDATE , m.HOSPITAL_SEQ ,
   							ROW_NUMBER() OVER(ORDER BY m.SEQ DESC) AS RN
   						FROM MEDICALRECODE m 
    						JOIN PETINFO p 
          					ON p.ID = m.PET_ID 
       						JOIN USERINFO u 
            				ON u.EMAIL = p.USER_EMAIL 
     					WHERE m.HOSPITAL_SEQ = '1')
     		WHERE RN BETWEEN 1 AND 5
      		ORDER BY SEQ DESC
	</select>

<!-- 병원 진료내역 전체 글 갯수(페이징 쿼리) -->
	<select id="recodeCount">
		SELECT COUNT(*) 
  			FROM MEDICALRECODE m 
                JOIN PETINFO p 
                ON p.ID = m.PET_ID 
                JOIN USERINFO u 
                ON u.EMAIL = p.USER_EMAIL 
        	WHERE m.HOSPITAL_SEQ = '1';
	</select>

<!-- 진료내역 상세정보 조회 -->
	<select id="detailRecode">
		SELECT m.SEQ , p.NAME , m.SYMPTOM ,
       			u.NAME , m.TREATMENT , m.PRESCRIPTION ,
       			m.TREATDATE , h.NAME 
        	FROM MEDICALRECODE m 
                JOIN PETINFO p 
                ON p.ID = m.PET_ID 
                JOIN USERINFO u 
                ON u.EMAIL = p.USER_EMAIL 
                JOIN HOSPITALINFO h 
                ON h.SEQ = m.HOSPITAL_SEQ 
    		WHERE m.SEQ = '9'
	</select>

<!-- 진료내역 수정 -->
	<update id="modifyRecode">
		UPDATE MEDICALRECODE
 			SET PET_ID='kckt66002M01',
                SYMPTOM='설사',
                TREATMENT='과식',
                PRESCRIPTION='설사약 과 하루 금식령'
			WHERE SEQ=9
	</update>

</mapper>
